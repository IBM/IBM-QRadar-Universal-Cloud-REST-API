<?xml version="1.0" encoding="UTF-8" ?>
<WorkflowParameterValues xmlns="http://qradar.ibm.com/UniversalCloudRESTAPI/WorkflowParameterValues/V1">
    <Value name="client_id"     value="" />
    <Value name="client_secret" value="" />

    <!-- Enter the domain for Token URL. Eg: auth.app.wiz.io -->
    <Value name="token_url_domain"     value="" />

    <!-- Enter the domain for Endpoint URL. Eg: api.eu.app.wiz.io -->
    <Value name="host"  value="" />

    <!-- Defines Authentication for Wiz Server. Accepted values=cognito/auth0 -->
    <Value name="auth_type"     value="cognito" />

    <Value
        name="gql_query"
        value="
           query IssuesTable($filterBy: IssueFilters, $first: Int, $after: String, $orderBy: IssueOrder) {
            issues: issuesV2(
                filterBy: $filterBy
                first: $first
                after: $after
                orderBy: $orderBy
            ) {
                nodes {
                id
                sourceRule {
                    ... on Control {
                    id
                    name
                    controlDescription: description
                    resolutionRecommendation
                    securitySubCategories {
                        title
                        category {
                        id
                        name
                        framework {
                            id
                            name
                        }
                        }
                    }
                    }
                    ... on CloudEventRule {
                    id
                    name
                    cloudEventRuleDescription: description
                    sourceType
                    type
                    }
                    ... on CloudConfigurationRule {
                    id
                    name
                    cloudConfigurationRuleDescription: description
                    remediationInstructions
                    serviceType
                    }
                }
                createdAt
                updatedAt
                dueAt
                type
                resolvedAt
                statusChangedAt
                projects {
                    id
                    name
                    businessUnit
                    riskProfile {
                    businessImpact
                    }
                }
                status
                severity
                entitySnapshot {
                    id
                    type
                    nativeType
                    name
                    status
                    cloudPlatform
                    cloudProviderURL
                    providerId
                    region
                    resourceGroupExternalId
                    subscriptionExternalId
                    subscriptionName
                    subscriptionTags
                    tags
                    createdAt
                    externalId
                }
                serviceTickets {
                    externalId
                    name
                    url
                }
                notes {
                    createdAt
                    updatedAt
                    text
                    user {
                    name
                    email
                    }
                    serviceAccount {
                    name
                    }
                }
                }
                pageInfo {
                hasNextPage
                endCursor
                }
            }
            }

        "
    />
    
    <Value
        name="audit_logs_gql_query"
        value="
            query AuditLogTable($first: Int $after: String $filterBy: AuditLogEntryFilters){
            auditLogEntries(first: $first after: $after filterBy: $filterBy) {
            nodes {
                __typename
                id
                action
                requestId
                status
                timestamp
                actionParameters
                userAgent
                sourceIP
                serviceAccount {
                id
                name
                }
                user {
                id
                name
                }
            }
            pageInfo {
                hasNextPage
                endCursor
            }
            }
        }
    "
    />

    <Value
        name="detections_gql_query"
        value="
              query Detections($filterBy: DetectionFilters, $first: Int, $after: String, $orderBy: DetectionOrder, $includeTriggeringEvents: Boolean = true) {
  detections(
    filterBy: $filterBy
    first: $first
    after: $after
    orderBy: $orderBy
    enforceTimestampContinuity: true
  ) {
    nodes {
     __typename
      id
      issue {
        id
        url
      }
      ruleMatch {
        rule {
          id
          name
          sourceType
          securitySubCategories {
            title
            category {
              name
              framework {
                name
              }
            }
          }
        }
      }
      description
      severity
      createdAt
      cloudAccounts {
        cloudProvider
        externalId
        name
        linkedProjects {
          id
          name
        }
      }
      cloudOrganizations {
        cloudProvider
        externalId
        name
      }
      startedAt
      endedAt
      actors {
        id
        externalId
        name
        type
        nativeType
        actingAs {
          id
          externalId
          name
          type
          nativeType
        }
      }
      primaryActor {
        id
      }
      resources {
        id
        externalId
        name
        type
        nativeType
        region
        cloudAccount {
          cloudProvider
          externalId
          name
        }
        kubernetesNamespace {
          id
          providerUniqueId
          name
        }
        kubernetesCluster {
          id
          providerUniqueId
          name
        }
      }
      primaryResource {
        id
      }
      triggeringEvents(first: 10) @include(if: $includeTriggeringEvents) {
        nodes {
          ... on CloudEvent {
            id
            origin
            name
            description
            cloudProviderUrl
            cloudPlatform
            timestamp
            source
            category
            status
            actor {
              id
              actingAs {
                id
              }
            }
            actorIP
            actorIPMeta {
              country
              autonomousSystemNumber
              autonomousSystemOrganization
              reputation
              reputationDescription
              reputationSource
              relatedAttackGroupNames
              customIPRanges {
                id
                name
                isInternal
                ipRanges
              }
            }
            resources {
              id
            }
            extraDetails {
              ... on CloudEventRuntimeDetails {
                processTree {
                  command
                  container {
                    id
                    externalId
                    name
                    image {
                      id
                      externalId
                    }
                  }
                  path
                  hash
                  size
                  executionTime
                  runtimeProgramId
                  userId
                  userName
                }
              }
            }
          }
        }
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}"
    />
</WorkflowParameterValues>
